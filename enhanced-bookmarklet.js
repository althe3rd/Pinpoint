!function(){"use strict";window.uwAccessibilityChecker?window.uwAccessibilityChecker.remove():(window.uwAccessibilityChecker={issues:[],axeLoaded:!1,init:function(){this.showLoadingPanel(),this.loadAxeCore()},showLoadingPanel:function(){const e=document.createElement("div");e.id="uw-a11y-panel",e.innerHTML='\n                <div id="uw-a11y-header">\n                    <h2>Pinpoint Accessibility Checker</h2>\n                    <button id="uw-a11y-close">✕</button>\n                </div>\n                <div id="uw-a11y-content">\n                    <div style="text-align: center; padding: 2rem;">\n                        <div class="uw-a11y-spinner"></div>\n                        <p style="margin-top: 1rem;">Loading axe-core accessibility engine...</p>\n                        <p style="font-size: 0.9rem; color: #666;">This may take a few seconds on first use.</p>\n                    </div>\n                </div>\n            ',this.addStyles(),document.body.appendChild(e),document.getElementById("uw-a11y-close").onclick=()=>this.remove()},loadAxeCore:function(){if(window.axe)return this.axeLoaded=!0,void this.runAxeChecks();const e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/axe-core@4.8.2/axe.min.js",e.onload=()=>{this.axeLoaded=!0,this.runAxeChecks()},e.onerror=()=>{this.showError("Failed to load axe-core. Please check your internet connection and try again.")},document.head.appendChild(e)},runAxeChecks:function(){if(!window.axe)return void this.showError("axe-core failed to load properly.");window.axe.run(document,{rules:{region:{enabled:!1}},tags:["wcag2a","wcag2aa","wcag21aa"],exclude:["#uw-a11y-panel",".uw-a11y-highlight"]},(e,n)=>{e?this.showError("Error running accessibility analysis: "+e.message):(this.processAxeResults(n),this.displayResults())})},processAxeResults:function(e){this.issues=[],e.violations.forEach(e=>{e.nodes.forEach(n=>{this.addIssue("error",e.description,this.buildDescription(e,n),this.getElementFromNode(n),this.buildRecommendation(e),e.helpUrl,e.impact||"serious",e.tags,this.buildDetailedInfo(e,n))})}),e.incomplete.forEach(e=>{e.nodes.forEach(n=>{this.addIssue("warning",e.description,"Manual review needed: "+this.buildDescription(e,n),this.getElementFromNode(n),this.buildRecommendation(e),e.helpUrl,e.impact||"moderate",e.tags,this.buildDetailedInfo(e,n))})}),this.axeResults={url:e.url,timestamp:e.timestamp,toolOptions:e.toolOptions,violations:e.violations.length,passes:e.passes.length,incomplete:e.incomplete.length,inapplicable:e.inapplicable.length,score:this.calculateAccessibilityScore(e)}},buildDescription:function(e,n){let t=e.help||e.description;return n.failureSummary&&(t+="\n\nDetails: "+n.failureSummary),n.html&&(t+="\n\nElement: "+n.html.substring(0,100),n.html.length>100&&(t+="...")),t},buildRecommendation:function(e){return e.help?e.help:"Please refer to the help documentation for specific guidance on fixing this issue."},getElementFromNode:function(e){if(e.target&&e.target.length>0)try{return document.querySelector(e.target[0])}catch(e){return null}return null},buildDetailedInfo:function(e,n){const t=[];if(n.html){t.push({type:"html",label:"HTML Source",value:n.html});const e=this.estimateLineNumber(n.html);e>0&&t.push({type:"line",label:"Approximate Line",value:e})}if(n.target&&n.target[0]&&t.push({type:"selector",label:"CSS Selector",value:n.target[0]}),"color-contrast"===e.id){const e=this.extractColorContrastInfo(n);e&&t.push({type:"colors",label:"Color Information",value:e})}if((e.id.includes("landmark")||e.id.includes("region"))&&t.push({type:"landmarks",label:"Landmark Context",value:this.analyzeLandmarkContext(n)}),e.id.includes("heading")&&t.push({type:"headings",label:"Heading Structure",value:this.analyzeHeadingStructure(n)}),n.failureSummary&&t.push({type:"failure",label:"Technical Details",value:n.failureSummary}),n.any&&n.any.length>0){const e=n.any.map(e=>e.message||e.id).filter(Boolean);e.length>0&&t.push({type:"checks",label:"Failed Checks",value:e.join(", ")})}return t},estimateLineNumber:function(e){try{const n=document.documentElement.outerHTML,t=n.indexOf(e.substring(0,50));if(t>-1){return n.substring(0,t).split("\n").length}}catch(e){}return 0},extractColorContrastInfo:function(e){try{const n=this.getElementFromNode(e);if(!n)return null;const t=window.getComputedStyle(n),i=t.color,o=t.backgroundColor,a=this.calculateContrastRatio(i,o);return{foreground:i,background:o,contrast:a?a.toFixed(2)+":1":"Unable to calculate",required:"WCAG AA requires 4.5:1 for normal text, 3:1 for large text"}}catch(e){return null}},calculateContrastRatio:function(e,n){try{const t=this.getLuminance(e),i=this.getLuminance(n);if(null===t||null===i)return null;const o=Math.max(t,i);return(o+.05)/(Math.min(t,i)+.05)}catch(e){return null}},getLuminance:function(e){try{if(e.startsWith("rgb")){const n=e.match(/\d+/g);if(n&&n.length>=3){const e=parseInt(n[0])/255,t=parseInt(n[1])/255;return.2126*e+.7152*t+.0722*(parseInt(n[2])/255)}}}catch(e){}return null},analyzeLandmarkContext:function(e){try{const n=this.getElementFromNode(e);if(!n)return"Element not found";return`Found ${document.querySelectorAll('main, nav, header, footer, aside, section[aria-label], section[aria-labelledby], [role="banner"], [role="navigation"], [role="main"], [role="contentinfo"], [role="complementary"]').length} landmarks on page. Current element: ${n.tagName.toLowerCase()}${n.getAttribute("role")?' (role="'+n.getAttribute("role")+'")':""}`}catch(e){return"Unable to analyze landmark context"}},analyzeHeadingStructure:function(e){try{const n=this.getElementFromNode(e);if(!n)return"Element not found";const t=Array.from(document.querySelectorAll("h1, h2, h3, h4, h5, h6")),i=t.indexOf(n),o=parseInt(n.tagName.charAt(1));let a=`Current: ${n.tagName} "${n.textContent.substring(0,50)}"`;if(i>0){const e=t[i-1],n=parseInt(e.tagName.charAt(1));a+=`\nPrevious: ${e.tagName} (level ${n})`,o>n+1&&(a+=`\nIssue: Skipped from H${n} to H${o}`)}return a}catch(e){return"Unable to analyze heading structure"}},calculateAccessibilityScore:function(e){const n={critical:10,serious:7,moderate:3,minor:1};let t=0,i=e.passes.length+e.violations.length+e.incomplete.length;if(e.violations.forEach(e=>{t+=e.nodes.length*(n[e.impact]||n.moderate)}),e.incomplete.forEach(e=>{t+=e.nodes.length*(.5*(n[e.impact]||n.moderate))}),0===i)return 100;const o=i*n.critical;return{score:Math.max(0,Math.round(100-t/o*100)),deductions:t,maxPossible:o,details:{violations:e.violations.length,incomplete:e.incomplete.length,passes:e.passes.length}}},showError:function(e){const n=document.getElementById("uw-a11y-panel");if(n){n.querySelector("#uw-a11y-content").innerHTML=`\n                    <div class="uw-a11y-issue error" style="margin: 1rem;">\n                        <h4>Error Loading Accessibility Checker</h4>\n                        <p>${e}</p>\n                        <p><strong>Suggestions:</strong></p>\n                        <ul>\n                            <li>Check your internet connection</li>\n                            <li>Try refreshing the page and running the bookmarklet again</li>\n                            <li>Ensure your browser allows loading external scripts</li>\n                        </ul>\n                    </div>\n                `}},createPanel:function(){let e=document.getElementById("uw-a11y-panel");return e||(e=document.createElement("div"),e.id="uw-a11y-panel",document.body.appendChild(e)),e.innerHTML='\n                <div id="uw-a11y-header">\n                    <h2>Pinpoint Accessibility Checker</h2>\n                    <button id="uw-a11y-close">✕</button>\n                </div>\n                <div id="uw-a11y-content">\n                    <div id="uw-a11y-summary"></div>\n                    <div id="uw-a11y-results"></div>\n                </div>\n            ',document.getElementById("uw-a11y-close").onclick=()=>this.remove(),e},addStyles:function(){if(document.getElementById("uw-a11y-styles"))return;const e=document.createElement("style");e.id="uw-a11y-styles",e.textContent="\n                #uw-a11y-panel {\n                    position: fixed;\n                    top: 20px;\n                    right: 20px;\n                    width: 450px;\n                    max-height: 85vh;\n                    background: #ffffff;\n                    border: 3px solid #c5050c;\n                    border-radius: 8px;\n                    box-shadow: 0 8px 32px rgba(0,0,0,0.3);\n                    z-index: 999999;\n                    font-family: Arial, sans-serif;\n                    font-size: 14px;\n                    overflow: hidden;\n                }\n                #uw-a11y-header {\n                    background: #c5050c;\n                    color: white;\n                    padding: 12px 16px;\n                    display: flex;\n                    justify-content: space-between;\n                    align-items: center;\n                }\n                #uw-a11y-header h2 {\n                    margin: 0;\n                    font-size: 16px;\n                    font-weight: bold;\n                }\n                #uw-a11y-close {\n                    background: none;\n                    border: none;\n                    color: white;\n                    font-size: 18px;\n                    cursor: pointer;\n                    padding: 0;\n                    width: 24px;\n                    height: 24px;\n                    border-radius: 50%;\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                }\n                #uw-a11y-close:hover {\n                    background: rgba(255,255,255,0.2);\n                }\n                #uw-a11y-content {\n                    max-height: calc(85vh - 60px);\n                    overflow-y: auto;\n                    padding: 16px;\n                }\n                #uw-a11y-summary {\n                    background: #f8f9fa;\n                    border: 1px solid #dee2e6;\n                    border-radius: 4px;\n                    padding: 12px;\n                    margin-bottom: 16px;\n                }\n                .uw-a11y-issue {\n                    margin-bottom: 12px;\n                    padding: 12px;\n                    border-left: 4px solid #ffc107;\n                    background: #fff3cd;\n                    border-radius: 0 4px 4px 0;\n                    cursor: pointer;\n                }\n                .uw-a11y-issue.error {\n                    border-left-color: #dc3545;\n                    background: #f8d7da;\n                }\n                .uw-a11y-issue.warning {\n                    border-left-color: #ffc107;\n                    background: #fff3cd;\n                }\n                .uw-a11y-issue.info {\n                    border-left-color: #17a2b8;\n                    background: #d1ecf1;\n                }\n                .uw-a11y-issue h4 {\n                    margin: 0 0 8px 0;\n                    font-size: 14px;\n                    font-weight: bold;\n                }\n                .uw-a11y-issue p {\n                    margin: 4px 0;\n                    line-height: 1.4;\n                }\n                .uw-a11y-issue .issue-meta {\n                    font-size: 12px;\n                    color: #666;\n                    margin-top: 8px;\n                    padding-top: 8px;\n                    border-top: 1px solid rgba(0,0,0,0.1);\n                }\n                .uw-a11y-issue .learn-more {\n                    color: #c5050c;\n                    text-decoration: none;\n                    font-size: 12px;\n                }\n                .uw-a11y-issue .learn-more:hover {\n                    text-decoration: underline;\n                }\n                .uw-a11y-highlight {\n                    background: yellow !important;\n                    border: 2px solid red !important;\n                    box-shadow: 0 0 0 2px yellow !important;\n                }\n                .uw-a11y-count {\n                    font-weight: bold;\n                    padding: 2px 8px;\n                    border-radius: 12px;\n                    color: white;\n                    font-size: 12px;\n                    margin-right: 8px;\n                }\n                .count-error { background: #dc3545; }\n                .count-warning { background: #ffc107; color: #212529; }\n                .count-info { background: #17a2b8; }\n                .uw-a11y-spinner {\n                    width: 40px;\n                    height: 40px;\n                    border: 4px solid #f3f3f3;\n                    border-top: 4px solid #c5050c;\n                    border-radius: 50%;\n                    animation: uw-spin 1s linear infinite;\n                    margin: 0 auto;\n                }\n                @keyframes uw-spin {\n                    0% { transform: rotate(0deg); }\n                    100% { transform: rotate(360deg); }\n                }\n                .axe-summary {\n                    font-size: 12px;\n                    color: #666;\n                    border-top: 1px solid #dee2e6;\n                    padding-top: 12px;\n                    margin-top: 12px;\n                }\n                .uw-a11y-score-container {\n                    text-align: center;\n                    margin: 1rem 0;\n                    padding: 1rem;\n                    background: #f8f9fa;\n                    border-radius: 8px;\n                    border: 2px solid #e9ecef;\n                }\n                .uw-a11y-score-dial {\n                    position: relative;\n                    width: 120px;\n                    height: 120px;\n                    margin: 0 auto 1rem auto;\n                }\n                .uw-a11y-score-circle {\n                    width: 120px;\n                    height: 120px;\n                    border-radius: 50%;\n                    background: conic-gradient(from 0deg, #28a745 0deg 0deg, #e9ecef 0deg 360deg);\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                    position: relative;\n                }\n                .uw-a11y-score-inner {\n                    width: 90px;\n                    height: 90px;\n                    background: white;\n                    border-radius: 50%;\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                    flex-direction: column;\n                    font-weight: bold;\n                }\n                .uw-a11y-score-number {\n                    font-size: 24px;\n                    color: #333;\n                }\n                .uw-a11y-score-label {\n                    font-size: 10px;\n                    color: #666;\n                    text-transform: uppercase;\n                }\n                .uw-a11y-details {\n                    margin-top: 1rem;\n                    padding: 0.5rem;\n                    background: #f1f3f4;\n                    border-left: 3px solid #007cba;\n                    border-radius: 0 4px 4px 0;\n                    font-size: 12px;\n                    display: none;\n                }\n                .uw-a11y-details.expanded {\n                    display: block;\n                }\n                .uw-a11y-details-toggle {\n                    background: none;\n                    border: none;\n                    color: #007cba;\n                    cursor: pointer;\n                    font-size: 12px;\n                    text-decoration: underline;\n                    padding: 0;\n                    margin-top: 0.5rem;\n                }\n                .uw-a11y-details-item {\n                    margin: 0.5rem 0;\n                    padding: 0.5rem;\n                    background: white;\n                    border-radius: 3px;\n                }\n                .uw-a11y-details-label {\n                    font-weight: bold;\n                    color: #495057;\n                }\n                .uw-a11y-details-value {\n                    font-family: monospace;\n                    background: #f8f9fa;\n                    padding: 0.25rem;\n                    border-radius: 2px;\n                    margin-top: 0.25rem;\n                    word-break: break-all;\n                }\n            ",document.head.appendChild(e)},addIssue:function(e,n,t,i,o,a,r,s,l){this.issues.push({type:e,title:n,description:t,element:i,recommendation:o,helpUrl:a,impact:r,tags:s||[],detailedInfo:l||[]})},displayResults:function(){this.createPanel();const e=document.getElementById("uw-a11y-summary"),n=document.getElementById("uw-a11y-results"),t=this.issues.filter(e=>"error"===e.type).length,i=this.issues.filter(e=>"warning"===e.type).length,o=(this.issues.filter(e=>"info"===e.type),this.axeResults?this.axeResults.score:null);e.innerHTML=`\n                ${o?this.renderScoreDial(o):""}\n                <h3>axe-core Accessibility Analysis</h3>\n                <p><strong>Total Issues Found:</strong> ${this.issues.length}</p>\n                <div style="margin: 8px 0;">\n                    <span class="uw-a11y-count count-error">${t}</span>Violations\n                    <span class="uw-a11y-count count-warning">${i}</span>Manual Review\n                </div>\n                <p><small>Click on any issue to highlight the element on the page.</small></p>\n                ${this.axeResults?`\n                    <div class="axe-summary">\n                        <strong>Test Summary:</strong> ${this.axeResults.violations} violations, \n                        ${this.axeResults.passes} passes, ${this.axeResults.incomplete} need review, \n                        ${this.axeResults.inapplicable} not applicable<br>\n                        <strong>Standard:</strong> WCAG 2.1 AA | <strong>Engine:</strong> axe-core\n                    </div>\n                `:""}\n            `,n.innerHTML=0===this.issues.length?'\n                    <div class="uw-a11y-issue info">\n                        <h4>Excellent Accessibility!</h4>\n                        <p>No accessibility violations detected by axe-core. Your page meets WCAG 2.1 AA automated testing standards.</p>\n                        <p><strong>Next Steps:</strong> Consider manual testing with screen readers and keyboard navigation for complete accessibility validation.</p>\n                    </div>\n                ':this.issues.map((e,n)=>`\n                    <div class="uw-a11y-issue ${e.type}" onclick="window.uwAccessibilityChecker.highlightElement(${n})" style="cursor: ${e.element?"pointer":"default"}">\n                        <h4>${e.title}</h4>\n                        <p>${e.description.split("\n")[0]}</p>\n                        <p><strong>How to fix:</strong> ${e.recommendation}</p>\n                        ${e.detailedInfo&&e.detailedInfo.length>0?`\n                            <button class="uw-a11y-details-toggle" onclick="window.uwAccessibilityChecker.toggleDetails(${n}); event.stopPropagation();">\n                                Show technical details\n                            </button>\n                            <div class="uw-a11y-details" id="details-${n}">\n                                ${this.renderDetailedInfo(e.detailedInfo)}\n                            </div>\n                        `:""}\n                        <div class="issue-meta">\n                            <strong>Impact:</strong> ${e.impact||"unknown"} | \n                            <strong>Tags:</strong> ${e.tags.join(", ")}\n                            ${e.helpUrl?`<br><a href="${e.helpUrl}" target="_blank" class="learn-more">Learn more about this rule</a>`:""}\n                        </div>\n                    </div>\n                `).join("")},highlightElement:function(e){document.querySelectorAll(".uw-a11y-highlight").forEach(e=>{e.classList.remove("uw-a11y-highlight")});const n=this.issues[e];n.element&&(n.element.classList.add("uw-a11y-highlight"),n.element.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>{n.element&&n.element.classList.remove("uw-a11y-highlight")},3e3))},renderScoreDial:function(e){const n=e.score,t=n/100*360;return`\n                <div class="uw-a11y-score-container">\n                    <div class="uw-a11y-score-dial">\n                        <div class="uw-a11y-score-circle" style="background: conic-gradient(from 0deg, ${90>n?70>n?50>n?"#dc3545":"#fd7e14":"#ffc107":"#28a745"} 0deg ${t}deg, #e9ecef ${t}deg 360deg);">\n                            <div class="uw-a11y-score-inner">\n                                <div class="uw-a11y-score-number">${n}</div>\n                                <div class="uw-a11y-score-label">Score</div>\n                            </div>\n                        </div>\n                    </div>\n                    <div style="font-size: 14px;">\n                        <strong>Accessibility Score:</strong> ${n}/100<br>\n                        <span style="font-size: 12px; color: #666;">\n                            ${90>n?70>n?50>n?"Poor accessibility - immediate attention needed":"Fair accessibility - several issues to address":"Good accessibility with room for improvement":"Excellent accessibility!"}\n                        </span>\n                    </div>\n                </div>\n            `},renderDetailedInfo:function(e){return e.map(e=>{let n=e.value;return"colors"===e.type&&"object"==typeof n&&(n=`\n                        <div style="margin: 0.5rem 0;">\n                            <div><strong>Foreground:</strong> <span style="background: ${n.foreground}; color: white; padding: 2px 6px; border-radius: 2px;">${n.foreground}</span></div>\n                            <div><strong>Background:</strong> <span style="background: ${n.background}; border: 1px solid #ccc; padding: 2px 6px; border-radius: 2px;">${n.background}</span></div>\n                            <div><strong>Contrast Ratio:</strong> ${n.contrast}</div>\n                            <div><strong>Requirement:</strong> ${n.required}</div>\n                        </div>\n                    `),`\n                    <div class="uw-a11y-details-item">\n                        <div class="uw-a11y-details-label">${e.label}:</div>\n                        <div class="uw-a11y-details-value">${n}</div>\n                    </div>\n                `}).join("")},toggleDetails:function(e){const n=document.getElementById(`details-${e}`),t=n.previousElementSibling;n.classList.contains("expanded")?(n.classList.remove("expanded"),t.textContent="Show technical details"):(n.classList.add("expanded"),t.textContent="Hide technical details")},remove:function(){const e=document.getElementById("uw-a11y-panel");e&&e.remove();const n=document.getElementById("uw-a11y-styles");n&&n.remove(),document.querySelectorAll(".uw-a11y-highlight").forEach(e=>{e.classList.remove("uw-a11y-highlight")}),delete window.uwAccessibilityChecker}},window.uwAccessibilityChecker.init())}();