(function(){'use strict';if(window.uwAccessibilityChecker){window.uwAccessibilityChecker.remove();return;}window.uwAccessibilityChecker={issues:[],axeLoaded:false,init:function(){this.showLoadingPanel();this.loadAxeCore();},showLoadingPanel:function(){var panel=document.createElement('div');panel.id='uw-a11y-panel';panel.innerHTML='<div id="uw-a11y-header"><h2>Pinpoint</h2><button id="uw-a11y-close">×</button></div><div id="uw-a11y-content"><div style="text-align: center; padding: 2rem;"><div class="uw-a11y-spinner"></div><p style="margin-top: 1rem;">Loading axe-core accessibility engine...</p><p style="font-size: 0.9rem; color: #666;">This may take a few seconds on first use.</p></div></div>';this.addStyles();document.body.appendChild(panel);var self=this;document.getElementById('uw-a11y-close').onclick=function(){self.remove();};},loadAxeCore:function(){if(window.axe){this.axeLoaded=true;this.runAxeChecks();return;}var script=document.createElement('script');var self=this;script.src='https://cdn.jsdelivr.net/npm/axe-core@4.8.2/axe.min.js';script.onload=function(){self.axeLoaded=true;self.runAxeChecks();};script.onerror=function(){self.showError('Failed to load axe-core. Please check your internet connection and try again.');};document.head.appendChild(script);},runAxeChecks:function(){if(!window.axe){this.showError('axe-core failed to load properly.');return;}var axeConfig={rules:{},tags:['wcag2a','wcag2aa','wcag21aa']};var self=this;window.axe.run(document,axeConfig,function(err,results){if(err){self.showError('Error running accessibility analysis: '+err.message);return;}self.processAxeResults(results);self.displayResults();});},processAxeResults:function(results){this.issues=[];var self=this;results.violations.forEach(function(violation){violation.nodes.forEach(function(node){self.addIssue('error',violation.description,self.buildDescription(violation,node),self.getElementFromNode(node),self.buildRecommendation(violation),violation.helpUrl,violation.impact||'serious',violation.tags,self.buildDetailedInfo(violation,node));});});results.incomplete.forEach(function(incomplete){incomplete.nodes.forEach(function(node){self.addIssue('warning',incomplete.description,'Manual review needed: '+self.buildDescription(incomplete,node),self.getElementFromNode(node),self.buildRecommendation(incomplete),incomplete.helpUrl,incomplete.impact||'moderate',incomplete.tags,self.buildDetailedInfo(incomplete,node));});});this.axeResults={url:results.url,timestamp:results.timestamp,violations:results.violations.length,passes:results.passes.length,incomplete:results.incomplete.length,inapplicable:results.inapplicable.length,score:this.calculateScore(results)};},calculateScore:function(results){var w={critical:10,serious:7,moderate:3,minor:1};var d=0,t=results.passes.length+results.violations.length+results.incomplete.length;results.violations.forEach(function(v){d+=(v.nodes.length*(w[v.impact]||w.moderate));});results.incomplete.forEach(function(i){d+=(i.nodes.length*(w[i.impact]||w.moderate)*0.5);});if(t===0)return{score:100};var m=t*w.critical;var s=Math.max(0,Math.round(100-(d/m)*100));return{score:s,deductions:d,maxPossible:m};},buildDetailedInfo:function(rule,node){var details=[];if(node.html){details.push({label:'HTML Source',value:node.html});var lineNum=this.estimateLineNumber(node.html);if(lineNum>0)details.push({label:'Approximate Line',value:lineNum});}if(node.target&&node.target[0])details.push({label:'CSS Selector',value:node.target[0]});if(rule.id==='color-contrast'){var colorInfo=this.extractColorInfo(node);if(colorInfo)details.push({label:'Color Information',value:colorInfo});}if(node.failureSummary)details.push({label:'Technical Details',value:node.failureSummary});return details;},estimateLineNumber:function(htmlSnippet){try{var docHTML=document.documentElement.outerHTML;var index=docHTML.indexOf(htmlSnippet.substring(0,50));if(index>-1){var before=docHTML.substring(0,index);return before.split('\n').length;}}catch(e){}return 0;},extractColorInfo:function(node){try{var el=this.getElementFromNode(node);if(!el)return null;var styles=window.getComputedStyle(el);var fg=styles.color;var bg=styles.backgroundColor;return'Foreground: '+fg+', Background: '+bg+' (WCAG AA requires 4.5:1 for normal text)';}catch(e){return null;}},buildDescription:function(rule,node){var description=rule.help||rule.description;if(node.failureSummary){description+='\\n\\nDetails: '+node.failureSummary;}if(node.html){description+='\\n\\nElement: '+node.html.substring(0,100);if(node.html.length>100)description+='...';}return description;},buildRecommendation:function(rule){return rule.help||'Please refer to the help documentation for specific guidance on fixing this issue.';},getElementFromNode:function(node){if(node.target&&node.target.length>0){try{return document.querySelector(node.target[0]);}catch(e){return null;}}return null;},showError:function(message){var panel=document.getElementById('uw-a11y-panel');if(panel){var content=panel.querySelector('#uw-a11y-content');content.innerHTML='<div class="uw-a11y-issue error" style="margin: 1rem;"><h4>Error Loading Accessibility Checker</h4><p>'+message+'</p><p><strong>Suggestions:</strong></p><ul><li>Check your internet connection</li><li>Try refreshing the page and running the bookmarklet again</li><li>Ensure your browser allows loading external scripts</li></ul></div>';}},createPanel:function(){var panel=document.getElementById('uw-a11y-panel');if(!panel){panel=document.createElement('div');panel.id='uw-a11y-panel';document.body.appendChild(panel);}panel.innerHTML='<div id="uw-a11y-header"><h2>Pinpoint</h2><button id="uw-a11y-close">×</button></div><div id="uw-a11y-content"><div id="uw-a11y-summary"></div><div id="uw-a11y-results"></div></div>';var self=this;document.getElementById('uw-a11y-close').onclick=function(){self.remove();};return panel;},addStyles:function(){if(document.getElementById('uw-a11y-styles'))return;var style=document.createElement('style');style.id='uw-a11y-styles';style.textContent='#uw-a11y-panel{position:fixed;top:20px;right:20px;width:450px;max-height:85vh;background:#ffffff;border:3px solid #c5050c;border-radius:8px;box-shadow:0 8px 32px rgba(0,0,0,0.3);z-index:999999;font-family:Arial,sans-serif;font-size:14px;overflow:hidden;}#uw-a11y-header{background:#c5050c;color:white;padding:12px 16px;display:flex;justify-content:space-between;align-items:center;}#uw-a11y-header h2{margin:0;font-size:16px;font-weight:bold;}#uw-a11y-close{background:none;border:none;color:white;font-size:18px;cursor:pointer;padding:0;width:24px;height:24px;border-radius:50%;display:flex;align-items:center;justify-content:center;}#uw-a11y-close:hover{background:rgba(255,255,255,0.2);}#uw-a11y-content{max-height:calc(85vh - 60px);overflow-y:auto;padding:16px;}#uw-a11y-summary{background:#f8f9fa;border:1px solid #dee2e6;border-radius:4px;padding:12px;margin-bottom:16px;}.uw-a11y-issue{margin-bottom:12px;padding:12px;border-left:4px solid #ffc107;background:#fff3cd;border-radius:0 4px 4px 0;cursor:pointer;}.uw-a11y-issue.error{border-left-color:#dc3545;background:#f8d7da;}.uw-a11y-issue.warning{border-left-color:#ffc107;background:#fff3cd;}.uw-a11y-issue.info{border-left-color:#17a2b8;background:#d1ecf1;}.uw-a11y-issue h4{margin:0 0 8px 0;font-size:14px;font-weight:bold;}.uw-a11y-issue p{margin:4px 0;line-height:1.4;}.uw-a11y-issue .issue-meta{font-size:12px;color:#666;margin-top:8px;padding-top:8px;border-top:1px solid rgba(0,0,0,0.1);}.uw-a11y-issue .learn-more{color:#c5050c;text-decoration:none;font-size:12px;}.uw-a11y-issue .learn-more:hover{text-decoration:underline;}.uw-a11y-highlight{background:yellow !important;border:2px solid red !important;box-shadow:0 0 0 2px yellow !important;}.uw-a11y-count{font-weight:bold;padding:2px 8px;border-radius:12px;color:white;font-size:12px;margin-right:8px;}.count-error{background:#dc3545;}.count-warning{background:#ffc107;color:#212529;}.count-info{background:#17a2b8;}.uw-a11y-spinner{width:40px;height:40px;border:4px solid #f3f3f3;border-top:4px solid #c5050c;border-radius:50%;animation:uw-spin 1s linear infinite;margin:0 auto;}@keyframes uw-spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}.axe-summary{font-size:12px;color:#666;border-top:1px solid #dee2e6;padding-top:12px;margin-top:12px;}.uw-a11y-score{text-align:center;margin:1rem 0;padding:1rem;background:#f8f9fa;border-radius:8px;border:2px solid #e9ecef;}.uw-a11y-score-circle{width:80px;height:80px;border-radius:50%;margin:0 auto 0.5rem;display:flex;align-items:center;justify-content:center;font-size:20px;font-weight:bold;color:white;}.uw-a11y-details{margin-top:0.5rem;padding:0.5rem;background:#f1f3f4;border-left:3px solid #007cba;border-radius:0 4px 4px 0;font-size:11px;display:none;}.uw-a11y-details.show{display:block;}.uw-a11y-toggle{background:none;border:none;color:#007cba;cursor:pointer;font-size:11px;text-decoration:underline;padding:0;margin-top:0.5rem;}';document.head.appendChild(style);},addIssue:function(type,title,description,element,recommendation,helpUrl,impact,tags,detailedInfo){this.issues.push({type:type,title:title,description:description,element:element,recommendation:recommendation,helpUrl:helpUrl,impact:impact,tags:tags||[],detailedInfo:detailedInfo||[]});},displayResults:function(){var panel=this.createPanel();var summary=document.getElementById('uw-a11y-summary');var results=document.getElementById('uw-a11y-results');var counts={error:this.issues.filter(function(i){return i.type==='error';}).length,warning:this.issues.filter(function(i){return i.type==='warning';}).length};var score=this.axeResults?this.axeResults.score.score:0;var scoreColor=score>=90?'#28a745':score>=70?'#ffc107':score>=50?'#fd7e14':'#dc3545';summary.innerHTML=(this.axeResults?'<div class="uw-a11y-score"><div class="uw-a11y-score-circle" style="background:'+scoreColor+';">'+score+'</div><div><strong>Accessibility Score:</strong> '+score+'/100</div><div style="font-size:12px;color:#666;">'+(score>=90?'Excellent!':score>=70?'Good':score>=50?'Fair':'Needs improvement')+'</div></div>':'')+'<h3>axe-core Accessibility Analysis</h3><p><strong>Total Issues Found:</strong> '+this.issues.length+'</p><div style="margin: 8px 0;"><span class="uw-a11y-count count-error">'+counts.error+'</span>Violations <span class="uw-a11y-count count-warning">'+counts.warning+'</span>Manual Review</div><p><small>Click on any issue to highlight the element on the page.</small></p>'+(this.axeResults?'<div class="axe-summary"><strong>Test Summary:</strong> '+this.axeResults.violations+' violations, '+this.axeResults.passes+' passes, '+this.axeResults.incomplete+' need review, '+this.axeResults.inapplicable+' not applicable<br><strong>Standard:</strong> WCAG 2.1 AA | <strong>Engine:</strong> axe-core</div>':'');if(this.issues.length===0){results.innerHTML='<div class="uw-a11y-issue info"><h4>Excellent Accessibility!</h4><p>No accessibility violations detected by axe-core. Your page meets WCAG 2.1 AA automated testing standards.</p><p><strong>Next Steps:</strong> Consider manual testing with screen readers and keyboard navigation for complete accessibility validation.</p></div>';}else{var self=this;results.innerHTML=this.issues.map(function(issue,index){var detailsHtml='';if(issue.detailedInfo&&issue.detailedInfo.length>0){detailsHtml='<button class="uw-a11y-toggle" onclick="window.uwAccessibilityChecker.toggleDetails('+index+'); event.stopPropagation();">Show details</button><div class="uw-a11y-details" id="details-'+index+'">'+issue.detailedInfo.map(function(d){return '<div><strong>'+d.label+':</strong> '+d.value+'</div>';}).join('')+'</div>';}return '<div class="uw-a11y-issue '+issue.type+'" onclick="window.uwAccessibilityChecker.highlightElement('+index+')" style="cursor: '+(issue.element?'pointer':'default')+'"><h4>'+issue.title+'</h4><p>'+issue.description.split('\\n')[0]+'</p><p><strong>How to fix:</strong> '+issue.recommendation+'</p>'+detailsHtml+'<div class="issue-meta"><strong>Impact:</strong> '+(issue.impact||'unknown')+' | <strong>Tags:</strong> '+issue.tags.join(', ')+(issue.helpUrl?'<br><a href="'+issue.helpUrl+'" target="_blank" class="learn-more">Learn more about this rule</a>':'')+'</div></div>';}).join('');}},toggleDetails:function(index){var details=document.getElementById('details-'+index);var button=details.previousElementSibling;if(details.classList.contains('show')){details.classList.remove('show');button.textContent='Show details';}else{details.classList.add('show');button.textContent='Hide details';}},highlightElement:function(issueIndex){document.querySelectorAll('.uw-a11y-highlight').forEach(function(el){el.classList.remove('uw-a11y-highlight');});var issue=this.issues[issueIndex];if(issue.element){issue.element.classList.add('uw-a11y-highlight');issue.element.scrollIntoView({behavior:'smooth',block:'center'});setTimeout(function(){if(issue.element){issue.element.classList.remove('uw-a11y-highlight');}},3000);}},remove:function(){var panel=document.getElementById('uw-a11y-panel');if(panel)panel.remove();var styles=document.getElementById('uw-a11y-styles');if(styles)styles.remove();document.querySelectorAll('.uw-a11y-highlight').forEach(function(el){el.classList.remove('uw-a11y-highlight');});delete window.uwAccessibilityChecker;}};window.uwAccessibilityChecker.init();})();